<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>사장 페이지</title>
  </head>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Dongle:wght@700&family=Jua&family=Noto+Serif+KR:wght@200&display=Gowun+Dodum&display=swap"
    rel="stylesheet"
  />

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"
  ></script>

  <style>
    tr,
    td,
    th {
      border: 1px solid #000;
    }
  </style>
  <body>
    <div class="container-fluid">
      <div class="container" style="margin-top: 20px">
        <div class="row">
          <div class="col-md-3"></div>
          <div class="col-md-6">
            <img
              src="https://www.gg.go.kr/site/gg/common/assets/images/img-header-logo.jpg"
              alt="logo"
            />
            <h1
              style="
                display: inline-block;
                text-align: center;
                margin-top: 50px;
                margin-bottom: 50px;
              "
            >
              경기도민
            </h1>
          </div>
          <div class="col-md-3"></div>
        </div>
      </div>
      <div class="container">
        <h2>사장 페이지</h2>
        <hr />
        <table style="width: 100%; text-align: center; margin-top: 1.5rem">
          <tr>
            <th>이름</th>
            <th>주소</th>
            <th>이미지</th>
            <th>요구사항</th>
            <th>시간</th>
            <th>상태</th>
          </tr>
          <!--        여기 부분에 들어갈 데이터들-->
          <% for(let data of datas){ %>
          <tr>
            <td style="width: 10%"><%= data.name %></td>
            <td style="width: 10%"><%= data.address %></td>
            <td style="width: 10%"><%= data.img %></td>
            <td style="width: 30%"><%= data.userWanted %></td>
            <td style="width: 20%">
              <%=
              data.createdAt.toISOString().substring(0,10).replaceAll("-",".")
              %>
            </td>
            <td style="width: 20%"><%= data.status %><button style="margin-left:1rem" class="status" value="<%= data.status %>, <%= data.workId %>">업데이트</button></td>
          </tr>
          <% } %>
        </table>
      <div class="container" style="text-align: center">
        <button
          type="button"
          style="
            width: 200px;
            height: 60px;
            margin-top: 40px;
            margin-right: 20px;
          "
          class="btn btn-primary"
          onclick="exitPageToReview()"
        >
          리뷰 조회하기
        </button>
      </div>
    </div>
  </body>
  <script>
    function exitPageToReview() {
      location.href = '/api/review/1';
    }
  </script>
  <script>
        document.addEventListener("DOMContentLoaded", () => {
      const status_btn = document.getElementsByClassName('status')

      for(let i = 0; i < status_btn.length; i++) {
        status_btn[i].addEventListener('click', () => {
          const data = status_btn[i].value
          console.log(data)
          const status = data.split(', ')[0]
          const workId = data.split(', ')[1]
          axios({
            method: 'post',
            url: '/api/updatework',
            data: {workId, status}
          }).then(() => {
            window.location.reload()
          })
        })
      }
    })
  </script>
</html>
